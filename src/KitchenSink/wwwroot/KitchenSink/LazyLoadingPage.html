<link rel="import" href="/sys/polymer/polymer.html">

<style>
    .kitchensink-lazy-loading__hover-box {
        background-color: rgba(255, 255, 255, 0.80);
        color: #000000;
        border: 2px solid rgba(255, 133, 0, 1);
        border-radius: 5px;
        width: 75%;
        min-height: 100px;
        margin-left: 12.5%;
    }
    .kitchensink-lazy-loading__hover-box p {
        font-size: 14px;
        text-align: center;
    }

    .kitchensink-lazy-loading__hover-content,
    .kitchensink-lazy-loading__hover-content--loading {
        display: none;
    }


    .loader {
        border: 5px solid #f3f3f3;
        border-radius: 50%;
        border-top: 5px solid rgba(255, 133, 0, 1);
        border-bottom: 5px solid rgba(255, 133, 0, 1);
        width: 50px;
        height: 50px;
        margin-left: calc(50% - 25px);
        -webkit-animation: spin 2s linear infinite;
        animation: spin 2s linear infinite;
    }

@-webkit-keyframes spin {
    0% { -webkit-transform: rotate(0deg); }
    100% { -webkit-transform: rotate(360deg); }
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

</style>

<template>
    <template is="dom-bind">
       <h4> Insert meaningful Title </h4>
        <p> Insert important information </p>
        <p> Perhaps a bit more information!</p>

        <table class="table table-striped table-hover table-sortable-list">
            <thead>
                <tr>
                    <th> Order </th>
                    <th> Name </th>
                    <th> Favorite Game </th>
                </tr>
            </thead>
            <tbody>
                <template is="dom-repeat" items="{{model.People}}" as="people">
                    <tr class="kitchensink-lazy-loading__tooltip" onmouseover="{{hoverFunction}}" onmouseout="{{hoverOutFunction}}">
                        <td>{{people.Order}}</td>
                        <td>{{people.FirstName}} {{people.LastName}} </td>
                        <td>{{people.FavoriteGame}}</td>
                    </tr>
                </template>
            </tbody>
        </table>

        <div class="kitchensink-lazy-loading__hover-box">
            <div class="kitchensink-lazy-loading__hover-content--loading" style="display:{{model.LoadVisualCss$}};">
                <p>{{model.SelectedPersonsName$}}'s Data</p>
                <div class="loader"></div>
            </div>
            <div class="kitchensink-lazy-loading__hover-content" style="display:{{model.DataVisualCss$}};">
                <p>{{model.SelectedPersonsName$}}'s Data</p>
                <p>{{model.DisplayedData.DataContent$}}</p>
            </div>
        </div>

    </template>
    <script>
        (function () {
            var script = document._currentScript || document.currentScript;
            var template = script.previousElementSibling;

            //On hover: wait 0,2~ seconds then start display something*
            //*something = either loading or data
            //if *something = loading. It should start loading, and when it finishes, it should display person-specific data

            // On hover exit: It should hide *something. 
            //if *something = loading, it should "cancel" the loading, (at least visually), and next time it gets hovered, it should display the loading again
            //if *something = data, it should just hide it, and the next time it gets hovered, it just display it again.




            template.hoverFunction = function (event) {
                var index = event.currentTarget.rowIndex - 1;
                template.set("model.SelectedPersonsName$", template.model.People[index].FirstName);
                triggerMouseup(event.currentTarget);


                if (template.model.People[index].DataIsLoaded == 0) { // Need to access loading screen, and access c#
                    template.set("model.People." + index + ".IsHovered$", 1); // Set a specific person as hovered + triggers the C# handle function
                    template.set("model.LoadVisualCss$", "block");
                    template.set("model.DataVisualCss$", "none");
                } else {
                    template.set("model.DataVisualCss$", "block");
                    template.set("model.DisplayedData.DataContent$", template.model.People[index].DataToShow);
                }
            };

            template.hoverOutFunction = function (event) {
                var index = event.currentTarget.rowIndex - 1; // This is the wrong target. Needs to be fixed
                template.set("model.People." + index + ".IsHovered$", 0);

                template.set("model.LoadVisualCss$", "none");
                template.set("model.DataVisualCss$", "none");
            };




            // Fakes a mouseclick, Is called on hover.
            //http://stackoverflow.com/questions/827716/emulate-clicking-a-link-with-javascript-that-works-with-ie
            function triggerMouseup(elem) {
                fireEvent((elem || document.body), 'mouseup')
            }

            function fireEvent(obj, evt) {

                var fireOnThis = obj;
                if (document.createEvent) {
                    var evObj = document.createEvent('MouseEvents');
                    evObj.initEvent(evt, true, false);
                    fireOnThis.dispatchEvent(evObj);

                } else if (document.createEventObject) {
                    var evObj = document.createEventObject();
                    fireOnThis.fireEvent('on' + evt, evObj);
                }
            }

        })();
    </script>
</template>